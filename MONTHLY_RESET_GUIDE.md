# ๐ ุฏููู ูุธุงู ุงูุชุฌุฏูุฏ ุงูุดูุฑู ููุฑุณุงุฆู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุงูุชุฌุฏูุฏ ุงูุดูุฑู ูุฅุนุงุฏุฉ ุชุนููู ุนุฏุงุฏ ุงูุฑุณุงุฆู ูู 30 ูููุงู ููุญุณุงุจุงุช ุงูููุนูุฉ ููุทุ ููุง ูุฌุนู ูุธุงู ุงูุงุดุชุฑุงูุงุช ุดูุฑูุงู ุจุฏูุงู ูู ุชุฑุงููู.

## ๐ฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ **ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู:**
- ูุชู ูุญุต ุงูุญุงุฌุฉ ููุชุฌุฏูุฏ ูุน ูู ุฑุณุงูุฉ ูู ุงูุดุงุช
- ุฅุนุงุฏุฉ ุชุนููู ุงูุฑุณุงุฆู ุงููุณุชุฎุฏูุฉ ุฅูู ุตูุฑ ูู 30 ููู
- ููุท ููุญุณุงุจุงุช ุฐุงุช ุญุงูุฉ `ACTIVE`

### ๐ **ุงูุฃูุงู:**
- ุงูุญุณุงุจุงุช ุบูุฑ ุงูููุนูุฉ (`TRIAL`, `CANCELLED`, `EXPIRED`) ูุง ุชุญุตู ุนูู ุชุฌุฏูุฏ
- ุชุณุฌูู ุฌููุน ุนูููุงุช ุงูุชุฌุฏูุฏ ูู ุงูุณุฌูุงุช
- ุฅููุงููุฉ ุงูุชุฌุฏูุฏ ุงููุฏูู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ

### ๐ **ููุญุฉ ุงูุฅุฏุงุฑุฉ:**
- ุตูุญุฉ ูุฎุตุตุฉ ูุฅุฏุงุฑุฉ ุงูุชุฌุฏูุฏ ุงูุดูุฑู
- ุนุฑุถ ุงูุญุณุงุจุงุช ุงููุคููุฉ ููุชุฌุฏูุฏ
- ุฅููุงููุฉ ุงูุชุฌุฏูุฏ ุงูุฌูุงุนู ุฃู ุงููุฑุฏู

## ๐๏ธ ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุญูู ุฌุฏูุฏ: `last_reset`
```sql
ALTER TABLE "Subscription" 
ADD COLUMN "last_reset" TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP;
```

## ๐ง ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

### 1. **ูุธุงู ุงูุชุฌุฏูุฏ ุงูุฃุณุงุณู:**
- `lib/monthly-reset.ts` - ููุทู ุงูุชุฌุฏูุฏ ุงูุดูุฑู
- `app/api/admin/monthly-reset/route.ts` - API endpoint ููุฅุฏุงุฑุฉ
- `app/admin/monthly-reset/page.tsx` - ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ

### 2. **ุงูุชุญุฏูุซุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ:**
- `prisma/schema.prisma` - ุฅุถุงูุฉ ุญูู `lastReset`
- `app/api/chat-supabase/[chatbotId]/route.ts` - ุงูุชุญูู ุงูุชููุงุฆู
- `app/admin/dashboard-simple/page.tsx` - ุฒุฑ ุงูุชุฌุฏูุฏ ุงูุดูุฑู

### 3. **ูููุงุช SQL:**
- `supabase-monthly-reset-migration.sql` - ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. **ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```bash
# ูู ุจุชุดุบูู SQL script ูู Supabase Dashboard
# ุฃู ุงุณุชุฎุฏู ุงูุฃูุฑ ุงูุชุงูู ุฅุฐุง ูุงู Prisma ูุชููุฑ ูุญููุงู:
npx prisma db push
```

### 2. **ุงููุตูู ูุฅุฏุงุฑุฉ ุงูุชุฌุฏูุฏ:**
1. ุงุฐูุจ ุฅูู ููุญุฉ ุงูุฅุฏุงุฑุฉ: `/admin/dashboard`
2. ุงุถุบุท ุนูู ุฒุฑ "๐ ุงูุชุฌุฏูุฏ ุงูุดูุฑู"
3. ุฃู ุงุฐูุจ ูุจุงุดุฑุฉ ุฅูู: `/admin/monthly-reset`

### 3. **ุฃููุงุน ุงูุชุฌุฏูุฏ:**

#### **ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู:**
- ูุญุฏุซ ุนูุฏ ุฃูู ุฑุณุงูุฉ ุจุนุฏ ูุฑูุฑ 30 ููู
- ููุท ููุญุณุงุจุงุช ุงูููุนูุฉ (`ACTIVE`)

#### **ุงูุชุฌุฏูุฏ ุงููุฏูู:**
- ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- ุฅููุงููุฉ ุชุฌุฏูุฏ ุฌููุน ุงููุคูููู ุจุถุบุทุฉ ูุงุญุฏุฉ
- ุฅููุงููุฉ ุชุฌุฏูุฏ ุญุณุงุจุงุช ูุญุฏุฏุฉ

## ๐ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุชุฌุฏูุฏ

### ุงูุชุจููุจุงุช ุงูุซูุงุซุฉ:

1. **๐ข ูุคูู ููุชุฌุฏูุฏ:**
   - ุญุณุงุจุงุช `ACTIVE` ูุฑ ุนูููุง 30+ ููู
   - ูููู ุชุฌุฏูุฏูุง ููุฑุงู

2. **๐ก ูุญุชุงุฌ ุชุฌุฏูุฏ (ุบูุฑ ููุนู):**
   - ุญุณุงุจุงุช ูุฑ ุนูููุง 30+ ููู ููู ููุณุช `ACTIVE`
   - ูู ูุชู ุชุฌุฏูุฏูุง ุชููุงุฆูุงู

3. **โช ูุญุฏุซ:**
   - ุญุณุงุจุงุช ุชู ุชุฌุฏูุฏูุง ูู ุขุฎุฑ 30 ููู

### ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ:
- **ุชุฌุฏูุฏ ุฌููุน ุงููุคูููู:** ุชุฌุฏูุฏ ุฌูุงุนู ูุฌููุน ุงูุญุณุงุจุงุช ุงูููุนูุฉ
- **ุชุฌุฏูุฏ ุงููุญุฏุฏ:** ุชุฌุฏูุฏ ุญุณุงุจุงุช ูุญุฏุฏุฉ ููุท
- **ุชุญุฏูุฏ ุงููู/ุฅูุบุงุก ุงูุชุญุฏูุฏ:** ูุณูููุฉ ุงูุชุญูู

## ๐ ูุฑุงูุจุฉ ุงููุธุงู

### ุงูุณุฌูุงุช:
```
๐ ุชู ุงูุชุฌุฏูุฏ ุงูุดูุฑู ููุชุงุฌุฑ: ุงุณู ุงููุชุฌุฑ (email@example.com) - 1000 ุฑุณุงูุฉ
โ Monthly Reset completed: 5 ูุฌุญุ 0 ูุดู ุจูุงุณุทุฉ ุงููุฏูุฑ: admin_zeyad
```

### ุฅุญุตุงุฆูุงุช ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ:
- ุฅุฌูุงูู ุงูุงุดุชุฑุงูุงุช
- ุนุฏุฏ ุงููุคูููู ููุชุฌุฏูุฏ
- ุนุฏุฏ ุงูุฐูู ูุญุชุงุฌูู ุชุฌุฏูุฏ (ุบูุฑ ููุนููู)
- ุนุฏุฏ ุงููุญุฏุซูู

## โก ุงูุฃุฏุงุก ูุงูุชุญุณููุงุช

### ููุงุฑุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
CREATE INDEX "idx_subscription_last_reset" ON "Subscription" ("last_reset");
CREATE INDEX "idx_subscription_status_last_reset" ON "Subscription" ("status", "last_reset");
```

### ุงูุชุญูู ุงูุฐูู:
- ูุญุต ุงูุชุฌุฏูุฏ ููุท ุนูุฏ ุงูุญุงุฌุฉ
- ุนุฏู ุชูุฑุงุฑ ุงูุชุฌุฏูุฏ ุฅุฐุง ุชู ุจุงููุนู
- ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ ููุฑ ุงูุชุฌุฏูุฏ

## ๐ก๏ธ ุงูุฃูุงู ูุงูุญูุงูุฉ

### ุญูุงูุฉ API:
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุฏูุฑ
- ุชุณุฌูู ุฌููุน ุงูุนูููุงุช
- ูุนุฑู ุงููุฏูุฑ ุงููููุฐ ููุนูููุฉ

### ุญูุงูุฉ ุงูุชุฌุฏูุฏ:
- ููุท ุงูุญุณุงุจุงุช ุงูููุนูุฉ (`ACTIVE`)
- ูุญุต ูุฏุฉ 30 ููู ุจุฏูุฉ
- ููุน ุงูุชุฌุฏูุฏ ุงููุถุงุนู

## ๐ Cron Job (ุงุฎุชูุงุฑู)

ููููู ุฅุนุฏุงุฏ cron job ูุชุดุบูู ุงูุชุฌุฏูุฏ ุชููุงุฆูุงู:

```bash
# ูู ููู ูู ุงูุณุงุนุฉ 2:00 ุตุจุงุญุงู
0 2 * * * curl -X POST "https://yoursite.com/api/admin/monthly-reset" \
  -H "Authorization: Bearer YOUR_ADMIN_SESSION" \
  -H "Content-Type: application/json" \
  -d "{}"
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ:

1. **ูุง ูุชู ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู:**
   - ุชุฃูุฏ ูู ุฃู ุงูุญุณุงุจ `ACTIVE`
   - ุชุฃูุฏ ูู ูุฑูุฑ 30+ ููู
   - ูุญุต ุณุฌูุงุช ุงูุฃุฎุทุงุก

2. **ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
   - ุชุฃูุฏ ูู ุชุดุบูู SQL migration
   - ูุญุต ูุฌูุฏ ุญูู `last_reset`

3. **ุฎุทุฃ ูู ุงูุตูุงุญูุงุช:**
   - ุชุฃูุฏ ูู ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ
   - ูุญุต ุตุญุฉ ุงูุฌูุณุฉ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ูุญุต ุงูุณุฌูุงุช ูู browser console
2. ูุญุต network requests ูู Developer Tools
3. ุงูุชุฃูุฏ ูู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ูุฑุงุฌุนุฉ ููู `.env` ูููุชุบูุฑุงุช ุงููุทููุจุฉ

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ **ูุธุงู ุดูุฑู ูุชูุงูู:** ุฅุนุงุฏุฉ ุชุนููู ุงูุฑุณุงุฆู ูู 30 ููู  
โ **ุฃูุงู ุนุงูู:** ููุท ุงูุญุณุงุจุงุช ุงูููุนูุฉ  
โ **ุฅุฏุงุฑุฉ ุณููุฉ:** ูุงุฌูุฉ ูุฏูุฑ ุดุงููุฉ  
โ **ุชููุงุฆู + ูุฏูู:** ูุฑููุฉ ูู ุงูุชุญูู  
โ **ูุฑุงูุจุฉ ุดุงููุฉ:** ุณุฌูุงุช ูุฅุญุตุงุฆูุงุช ููุตูุฉ  

ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุนูู ุจููุงุกุฉ ุนุงููุฉ! ๐ 