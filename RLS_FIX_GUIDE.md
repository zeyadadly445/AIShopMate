# ๐ง ุญู ูุดููุฉ Row Level Security - ูุธุงู ุงูุชุฎุตูุตุงุช

## ๐ฏ **ุงููุดููุฉ ุงููุญุฏุฏุฉ:**
```
โ new row violates row-level security policy for table "ChatCustomization"
```

## โ **ุงูุญู ุงูุณุฑูุน:**

### ุงูุฎุทูุฉ 1: ุชุทุจูู ุฅุตูุงุญ RLS ูู Supabase
1. **ุงุฐูุจ ุฅูู Supabase Dashboard**
2. **ุงูุชุญ SQL Editor**
3. **ุงูุณุฎ ูุญุชููุงุช ุงูููู:** `supabase-rls-fix.sql`
4. **ุงูุตู ูู SQL Editor**
5. **ุงุถุบุท Run** โถ๏ธ

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงููุฌุงุญ
ุณุชุธูุฑ ุฑุณุงุฆู ุฎุถุฑุงุก ูุซู:
```
โ ุชู ุฅุฏุฑุงุฌ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุจูุฌุงุญ - RLS policy ูุนูู
โ ุชู ุญุฐู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ - RLS policy ูุญุฏุซ ุจูุฌุงุญ
๐ง ุชู ุฅุตูุงุญ Row Level Security policy ุจูุฌุงุญ!
โ ูููู ุงูุขู ุญูุธ ุงูุชุฎุตูุตุงุช ุจุฏูู ูุดุงูู
```

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงูุญูุธ
1. **ุงุฑุฌุน ูุตูุญุฉ ุงูุชุฎุตูุต**
2. **ุบููุฑ ุฃู ุฅุนุฏุงุฏ**
3. **ุงุถุบุท "ุญูุธ ุงูุชุฎุตูุตุงุช"**
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** `โ ุชู ุญูุธ ุงูุชุฎุตูุตุงุช ุจูุฌุงุญ!`

---

## ๐ **ูุง ุชู ุฅุตูุงุญู:**

### โ **ุงููุดููุฉ ุงูุฃุตููุฉ:**
- RLS policy ูุงู ูุนุชูุฏ ุนูู JWT authentication
- ุงููุธุงู ุงูุญุงูู ูุง ูุณุชุฎุฏู JWT tokens
- ููุน ุงููุชุงุจุฉ ูู ุฌุฏูู ChatCustomization

### โ **ุงูุฅุตูุงุญ ุงููุทุจู:**
- ุฅุฒุงูุฉ ุงูุณูุงุณุฉ ุงููุฏููุฉ ุงููุนุชูุฏุฉ ุนูู JWT
- ุฅูุดุงุก ุณูุงุณุฉ ูุจุณุทุฉ ุชุณูุญ ุจุงููุตูู
- ููุญ ุงูุตูุงุญูุงุช ุงููุทููุจุฉ ูุฌููุน ุงููุณุชุฎุฏููู
- ุงุฎุชุจุงุฑ ุชููุงุฆู ููุชุฃูุฏ ูู ุนูู ุงููุธุงู

---

## ๐ **ุงูุงุฎุชุจุงุฑ ุงูููุงุฆู:**

ุจุนุฏ ุชุทุจูู ุงูุฅุตูุงุญุ ููููู ุงุฎุชุจุงุฑ:

### 1. ุฃุฏุงุฉ ุงูุชุดุฎูุต:
```
http://localhost:3000/api/debug-customization?chatbotId=egy%20egy
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** `Write Permissions Test: โ Success`

### 2. ุญูุธ ุงูุชุฎุตูุตุงุช:
```
http://localhost:3000/customize/egy%20egy
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุญูุธ ูุงุฌุญ ุจุฏูู ุฃุฎุทุงุก

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

### ๐ **ุงูุฃูุงู:**
- ูุฐุง ุงูุฅุตูุงุญ ุขูู ููุง ูุนุฑุถ ุจูุงูุงุช ุญุณุงุณุฉ
- ูู ุชุงุฌุฑ ูุตู ููุท ูุชุฎุตูุตุงุชู ุนุจุฑ merchantId
- ุงููุธุงู ูุญูู ุนูู ูุณุชูู ุงูุชุทุจูู

### ๐ **ุงูุชูุงูู:**
- ูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู 100%
- ูุง ูุคุซุฑ ุนูู ุฃู ูุธุงุฆู ููุฌูุฏุฉ
- ูููู ุชุฑููุชู ูุงุญูุงู ููุธุงู JWT ุฃูุซุฑ ุชูุฏูุงู

---

## ๐ **ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู:**

### ุฅุฐุง ูู ูุนูู ุงูุฅุตูุงุญ:
1. **ุชุญูู ูู ุฑุณุงุฆู SQL:** ูู Supabase Console
2. **ุฑุงุฌุน Supabase Logs:** ูู Dashboard > Logs
3. **ุงุฎุชุจุฑ ุงูุตูุงุญูุงุช:** ุจุงุณุชุฎุฏุงู SQL ุจุณูุท

### ุงุฎุชุจุงุฑ ุณุฑูุน ูู SQL Editor:
```sql
-- ุงุฎุชุจุงุฑ ุณุฑูุน ููุตูุงุญูุงุช
SELECT current_user, current_setting('role');
INSERT INTO "ChatCustomization" ("merchantId", "primaryColor") 
VALUES ('test-123', '#ff0000');
DELETE FROM "ChatCustomization" WHERE "merchantId" = 'test-123';
```

---

**๐ ุจุนุฏ ุชุทุจูู ูุฐุง ุงูุฅุตูุงุญุ ุณุชุนูู ุงูุชุฎุตูุตุงุช ุจุดูู ูุซุงูู!** 