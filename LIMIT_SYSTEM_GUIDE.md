# ๐ซ ูุธุงู ุงููููุฏ ุงููููุนู - ุฏููู ุดุงูู

## โ **ุชู ุชูุนูู ุงููุธุงู ุจูุฌุงุญ!**

---

## ๐ **ููู ูุนูู ุงููุธุงูุ**

### 1๏ธโฃ **ูุญุต ูู ุตูุญุฉ ุงูุดุงุช:**
```typescript
// ุนูุฏ ุฏุฎูู ุงููุณุชุฎุฏู ูุตูุญุฉ ุงูุดุงุช
// ูุชู ูุญุต ุงูุงุดุชุฑุงู ุฃููุงู ูุจู ุงูุณูุงุญ ุจุงูุฏุฎูู

if (subscription.status !== 'ACTIVE' && subscription.status !== 'TRIAL') {
  // ุชูุฌูู ููุฑู ูุตูุญุฉ limit-reached
  window.location.href = `/chat/${chatbotId}/limit-reached`
}

if (subscription.messagesUsed >= subscription.messagesLimit) {
  // ุชูุฌูู ููุฑู ูุตูุญุฉ limit-reached
  window.location.href = `/chat/${chatbotId}/limit-reached`
}
```

### 2๏ธโฃ **ูุญุต ูู ุฌููุน APIs:**
- โ `/api/chat-supabase/[chatbotId]` - ูููุนู
- โ `/api/chat/[chatbotId]` - ูููุนู  
- โ `/api/chat-stream/[chatbotId]` - ูููุนู

```typescript
// ูู ุฌููุน APIs
if (subscription.messagesUsed >= subscription.messagesLimit) {
  return NextResponse.json({
    response: 'ุนุฐุฑุงูุ ุชู ุงุณุชููุงุฏ ุญุฏ ุงูุฑุณุงุฆู ุงููุณููุญ.',
    redirectTo: `/chat/${chatbotId}/limit-reached`,
    reason: 'message_limit_reached'
  }, { status: 403 })
}
```

### 3๏ธโฃ **ุตูุญุฉ limit-reached ูุญุณูุฉ:**
- โ ุนุฑุถ ุชูุงุตูู ุงูุงุดุชุฑุงู
- โ ุดุฑูุท ุชูุฏู ุงูุงุณุชุฎุฏุงู
- โ ูุนูููุงุช ุงูุชูุงุตู ุงูุจุฏููุฉ
- โ ุชุตููู ุงุญุชุฑุงูู

---

## ๐๏ธ **APIs ุงููุญุฏุซุฉ:**

### ๐ **API `/api/merchant/[chatbotId]`:**
```typescript
// ุงูุขู ูุฑุฌุน ูุนูููุงุช ุงูุงุดุชุฑุงู
{
  subscription: {
    plan: "BASIC",
    status: "ACTIVE", 
    messagesLimit: 1000,
    messagesUsed: 950,
    lastReset: "2024-01-01"
  }
}
```

### ๐ **ุฌููุน Chat APIs:**
- ูุญุต ุญุงูุฉ ุงูุงุดุชุฑุงู (`ACTIVE` ุฃู `TRIAL`)
- ูุญุต ุญุฏ ุงูุฑุณุงุฆู (`messagesUsed >= messagesLimit`)
- ุฅุฑุฌุงุน status 403 ูุน redirectTo
- ุชุญุฏูุซ ุนุฏุงุฏ ุงูุฑุณุงุฆู ุนูุฏ ุงููุฌุงุญ

---

## ๐ฏ **ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู:**

### ๐ **ุงููุณุชุฎุฏู ุงูุนุงุฏู (ุชุญุช ุงูุญุฏ):**
```
1. ูุฏุฎู ูุตูุญุฉ ุงูุดุงุช โ โ ูุฏุฎู ุจูุฌุงุญ
2. ูุฑุณู ุฑุณุงูุฉ โ โ ูุญุตู ุนูู ุฑุฏ
3. ุงูุนุฏุงุฏ ูุฒูุฏ: messagesUsed++
```

### ๐ก **ุงููุณุชุฎุฏู ุงููุฑูุจ ูู ุงูุญุฏ (90%+):**
```
1. ูุฏุฎู ูุตูุญุฉ ุงูุดุงุช โ โ ูุฏุฎู ุจูุฌุงุญ 
2. Console log: โ๏ธ HIGH USAGE WARNING: Near message limit!
3. ูุฑุณู ุฑุณุงูุฉ โ โ ูุญุตู ุนูู ุฑุฏ
4. ุงูุนุฏุงุฏ ูุฒูุฏ: messagesUsed++
```

### ๐ด **ุงููุณุชุฎุฏู ูุตู ููุญุฏ:**
```
1. ูุฏุฎู ูุตูุญุฉ ุงูุดุงุช โ ๐ซ ุชูุฌูู ููุฑู ูู limit-reached
2. ุฃู ูุญุงูู ุฅุฑุณุงู ุฑุณุงูุฉ โ ๐ซ ุฎุทุฃ 403 + ุชูุฌูู
3. ููุนุฑุถ ูู ุตูุญุฉ limit-reached ูุน ุงูุชูุงุตูู
```

### โซ **ุงุดุชุฑุงู ุบูุฑ ูุนุงู:**
```
1. status = "CANCELLED" ุฃู "EXPIRED"
2. ูุฏุฎู ูุตูุญุฉ ุงูุดุงุช โ ๐ซ ุชูุฌูู ููุฑู ูู limit-reached  
3. ููุนุฑุถ ูู ุตูุญุฉ limit-reached ูุน ุณุจุจ ุงูุชููู
```

---

## ๐ **ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู:**

### ๐ **Logs ูู Console:**
```bash
# ุนูุฏ ุงููุญุต ุงููุงุฌุญ
โ Subscription valid: {
  status: "ACTIVE",
  used: 450,
  limit: 1000, 
  remaining: 550
}

# ุนูุฏ ุงููุตูู ููุญุฏ
๐ซ Message limit reached: 1000 >= 1000

# ุนูุฏ ุงูุชุญุฏูุซ
๐ Message count updated: 1001
```

### ๐ **ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู:**
```bash
๐ Current usage: {
  used: 950,
  limit: 1000,
  percentage: 95,
  remaining: 50
}

โ๏ธ HIGH USAGE WARNING: Near message limit!
```

---

## ๐ง **ุงุฎุชุจุงุฑ ุงููุธุงู:**

### 1๏ธโฃ **ุงุฎุชุจุงุฑ ุงููุตูู ููุญุฏ:**
```sql
-- ูู Supabase SQL Editor
UPDATE "Subscription" 
SET "messagesUsed" = "messagesLimit" 
WHERE "merchantId" = 'merchant_id_here';
```

### 2๏ธโฃ **ุงุฎุชุจุงุฑ ุฅููุงู ุงูุงุดุชุฑุงู:**
```sql
-- ูู Supabase SQL Editor  
UPDATE "Subscription"
SET "status" = 'CANCELLED'
WHERE "merchantId" = 'merchant_id_here';
```

### 3๏ธโฃ **ุฅุนุงุฏุฉ ุชุนููู ููุงุฎุชุจุงุฑ:**
```sql
-- ุฅุนุงุฏุฉ ุชูุนูู ุงูุงุดุชุฑุงู
UPDATE "Subscription"
SET "status" = 'ACTIVE', "messagesUsed" = 0
WHERE "merchantId" = 'merchant_id_here';
```

---

## ๐ **URLs ููุงุฎุชุจุงุฑ:**

### โ **ุตูุญุฉ ุดุงุช ุนุงุฏูุฉ:**
```
https://yoursite.com/chat/chatbot123
```

### ๐ซ **ุตูุญุฉ limit-reached:**
```
https://yoursite.com/chat/chatbot123/limit-reached
```

### ๐ **API ููุชุญูู:**
```bash
# ุงุฎุชุจุงุฑ API
curl -X POST https://yoursite.com/api/chat-supabase/chatbot123 \
  -H "Content-Type: application/json" \
  -d '{"message": "ูุฑุญุจุง", "sessionId": "test123"}'

# ุฅุฐุง ูุตู ููุญุฏ ุณูุฑุฌุน:
{
  "response": "ุนุฐุฑุงูุ ุชู ุงุณุชููุงุฏ ุญุฏ ุงูุฑุณุงุฆู ุงููุณููุญ.",
  "redirectTo": "/chat/chatbot123/limit-reached",
  "reason": "message_limit_reached"
}
```

---

## ๐จ **ูููุฒุงุช ุตูุญุฉ limit-reached:**

### ๐ฑ **ุชุตููู ูุชุฌุงูุจ:**
- โ ุดุนุงุฑ ุงููุชุฌุฑ ููููู ุงูุฃุณุงุณู
- โ ุฑุณุงูุฉ ูุงุถุญุฉ ุนู ุงูุณุจุจ
- โ ุดุฑูุท ุชูุฏู ุงูุงุณุชุฎุฏุงู
- โ ุชูุงุตูู ุงูุงุดุชุฑุงู (ุฎุทุฉุ ุญุงูุฉุ ุงุณุชุฎุฏุงู)
- โ ูุนูููุงุช ุงูุชูุงุตู ุงูุจุฏููุฉ

### ๐ **ูุนูููุงุช ุชูุตูููุฉ:**
```typescript
// ุนุฑุถ ุดุฑูุท ุงูุชูุฏู
const percentage = (messagesUsed / messagesLimit) * 100
// ุนุฑุถ: "95% ูุณุชุฎุฏู"

// ุนุฑุถ ุชูุงุตูู ุงูุงุดุชุฑุงู
- ุงูุฎุทุฉ: BASIC
- ุงูุญุงูุฉ: ACTIVE  
- ุงูุฑุณุงุฆู ุงููุณุชุฎุฏูุฉ: 1,000
- ุงูุญุฏ ุงูุฃูุตู: 1,000
```

---

## ๐ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

### โ **ุงูุขู ูุญุฏุซ:**
1. **ูุญุต ููุณุจู** ูู ุตูุญุฉ ุงูุดุงุช ูุจู ุงูุฏุฎูู
2. **ูุญุต ููุณุชูุฑ** ูู ุฌููุน Chat APIs  
3. **ุชูุฌูู ููุฑู** ูุตูุญุฉ limit-reached ุนูุฏ ุงููุตูู ููุญุฏ
4. **ุตูุญุฉ ูุญุณูุฉ** ูุน ุชูุงุตูู ูุงููุฉ ุนู ุงูุงุดุชุฑุงู
5. **ูุฑุงูุจุฉ ุดุงููุฉ** ูุน logs ููุตูุฉ
6. **ุชุญุฏูุซ ุฏููู** ูุนุฏุงุฏ ุงูุฑุณุงุฆู ูู ุฌููุน ุงูุญุงูุงุช

### ๐ **ุญูุงูุฉ ูุงููุฉ:**
- โ ูุง ูููู ุชุฌุงูุฒ ุงูุญุฏ ุนุจุฑ ุฃู API
- โ ูุง ูููู ุงูุฏุฎูู ููุดุงุช ุจุนุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู
- โ ูุง ูููู ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ุจุทุฑู ุจุฏููุฉ
- โ ุญูุงูุฉ ุดุงููุฉ ูุฌููุน ููุงุท ุงูุฏุฎูู

### ๐ฏ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ:**
- ๐ก ุฑุณุงุฆู ูุงุถุญุฉ ููููููุฉ
- ๐ ูุนูููุงุช ุชูุตูููุฉ ุนู ุงูุงุณุชุฎุฏุงู
- ๐ ุทุฑู ุชูุงุตู ุจุฏููุฉ ูุงุถุญุฉ
- ๐จ ุชุตููู ุงุญุชุฑุงูู ููุชุฌุงูุจ

---

## ๐ฅ **ุงููุธุงู ุฌุงูุฒ 100%!**

**๐ ูุธุงู ุงููููุฏ ูููุนู ุจุงููุงูู ููุนูู ุนูู ุฌููุน ุงููุณุชููุงุช!**

ุงููุธุงู ุงูุขู ูุญูู ุจุดูู ุดุงูู ููููุฑ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ ุนูุฏ ุงููุตูู ููุญุฏูุฏ ุงููุณููุญุฉ. 