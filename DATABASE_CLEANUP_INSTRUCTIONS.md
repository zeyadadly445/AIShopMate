# ๐งน ุฏููู ุงูุชูุธูู ุงูุขูู ููุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐จ ุญู ูุดููุฉ ุฎุทุฃ VACUUM

ุงูุฎุทุฃ ุงูุฐู ูุงุฌูุชู:
```
ERROR: 25001: VACUUM cannot run inside a transaction block
```

**ุงูุณุจุจ**: ุฃูุฑ `VACUUM` ูุง ูููู ุชูููุฐู ูุน ุฃูุงูุฑ ุฃุฎุฑู ูู ููุณ ุงูููุช ูู Supabase.

**ุงูุญู**: ุชู ุฅูุดุงุก ูููุงุช ูููุตูุฉ ุขููุฉ ูุชุฌูุจ ูุฐู ุงููุดููุฉ.

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ ุงูุขููุฉ

### 1๏ธโฃ **supabase-safe-cleanup.sql**
- โ ุชูุธูู ุขูู ุจุฏูู ุฃูุงูุฑ VACUUM
- โ ูุญุงูุธ ุนูู ุงูุฌุฏุงูู ุงููููุฉ
- โ ูุนุฑุถ ูุง ุณูุชู ุญุฐูู ูุจู ุงูุญุฐู

### 2๏ธโฃ **supabase-vacuum-optimize.sql**  
- โ ุฃูุงูุฑ ุชุญุณูู ุงูุฃุฏุงุก ูููุตูุฉ
- โ ููููุฐ ุจุนุฏ ุงูุชูุธูู
- โ ุขูู ููุชูููุฐ

---

## ๐ ุงูุฌุฏุงูู ุงููุญููุฉ (ูู ูุชู ุญุฐููุง)

| ุงูุฌุฏูู | ุงููุตู | ุงูุญุงูุฉ |
|--------|--------|--------|
| **Merchant** | ุจูุงูุงุช ุงูุชุฌุงุฑ | โ ูุญูู |
| **Subscription** | ุงูุงุดุชุฑุงูุงุช ูุงูุญุฏูุฏ | โ ูุญูู |
| **MerchantDataSource** | ูุตุงุฏุฑ ุงูุจูุงูุงุช | โ ูุญูู |

---

## โ ุงูุฌุฏุงูู ุงูุชู ุณุชูุญุฐู

| ุงูุฌุฏูู | ุงูุณุจุจ | ุฎุทูุฑุฉ ุงูุญุฐู |
|--------|--------|-------------|
| **DailyUsageStats** | ูู ูุนุฏ ูุญุชุงุฌู ูู ุงููุธุงู ุงููุจุณุท | โ๏ธ ููุฎูุถุฉ |
| **MerchantAnalytics** | ุบูุฑ ูุณุชุฎุฏู | โ๏ธ ููุฎูุถุฉ |
| **Admin, AdminAuditLog** | ุงุฎุชูุงุฑู - ูุธุงู ุฅุฏุงุฑุฉ ูููุตู | โ๏ธ ูุชูุณุทุฉ |

---

## โก ุฎุทูุงุช ุงูุชูููุฐ ุงูุขูู

### **ุงูุฎุทูุฉ 1: ุงููุณุฎ ุงูุงุญุชูุงุทู**
```bash
# ูู Supabase Dashboard > Settings > Database
# ุงุฐูุจ ุฅูู Backups ูุฃูุดุฆ backup ุฌุฏูุฏ
```

### **ุงูุฎุทูุฉ 2: ูุญุต ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ**
```sql
-- ูู Supabase SQL Editorุ ููุฐ ูุฐุง ุฃููุงู:
SELECT table_name, table_type 
FROM information_schema.tables 
WHERE table_schema = 'public' 
ORDER BY table_name;
```

### **ุงูุฎุทูุฉ 3: ุงูุชูุธูู ุงูุขูู**
```bash
# ูู Supabase SQL Editor
# ุงูุณุฎ ูุงูุตู ูุญุชูู ููู: supabase-safe-cleanup.sql
# ูููุฐู ุจุงููุงูู
```

### **ุงูุฎุทูุฉ 4: ุชุญุณูู ุงูุฃุฏุงุก (ุงุฎุชูุงุฑู)**
```bash
# ูู Supabase SQL Editor
# ุงูุณุฎ ูุงูุตู ูุญุชูู ููู: supabase-vacuum-optimize.sql
# ูููุฐู ุจุงููุงูู (ุฃู ููุฐ ูู ุฃูุฑ ุนูู ุญุฏุฉ)
```

---

## ๐งช ุงุฎุชุจุงุฑ ูุง ุจุนุฏ ุงูุชูุธูู

### **ูุญุต ุงูุฌุฏุงูู ุงููุชุจููุฉ:**
```sql
SELECT 
    'ุงูุฌุฏุงูู ุงููุชุจููุฉ' as info,
    string_agg(table_name, ', ') as tables
FROM information_schema.tables 
WHERE table_schema = 'public' 
    AND table_type = 'BASE TABLE';
```

### **ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุจุณุท:**
```sql
-- ุงุฎุชุจุงุฑ ุงูุฏูุงู ุงูุฌุฏูุฏุฉ
SELECT * FROM check_message_limits('any_merchant_id');

-- ุงุฎุชุจุงุฑ ุงูู view ุงูุฌุฏูุฏ
SELECT COUNT(*) FROM "MerchantLimitsView";
```

### **ุงุฎุชุจุงุฑ Chat API:**
```bash
# ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุฑุณุงูุฉ
curl -X POST /api/chat-supabase/YOUR_CHATBOT_ID \
  -H "Content-Type: application/json" \
  -d '{"message": "ุงุฎุชุจุงุฑ", "sessionId": "test123"}'
```

---

## ๐จ ูู ุญุงูุฉ ุงููุดุงูู

### **ุฅุฐุง ุชู ุญุฐู ุฌุฏูู ููู ุจุงูุฎุทุฃ:**
```sql
-- ูููู ุงุณุชุฑุฏุงุฏู ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
-- ุงุฐูุจ ุฅูู Supabase > Settings > Database > Backups
-- ูุงุฎุชุฑ Restore ูู backup ุณุงุจู
```

### **ุฅุฐุง ูู ุชุนูู ุงูุฏูุงู:**
```sql
-- ุฃุนุฏ ุชูููุฐ ููู ุงููุธุงู ุงูุฃุณุงุณู
-- supabase-simplified-limits.sql
```

### **ุฅุฐุง ูุงุฌูุช ุฎุทุฃ VACUUM ูุฑุฉ ุฃุฎุฑู:**
```bash
# ููุฐ ุฃูุงูุฑ VACUUM ูุงุญุฏุงู ุชูู ุงูุขุฎุฑ:
VACUUM ANALYZE "Merchant";
# ุงูุชุธุฑ ุญุชู ููุชููุ ุซู ููุฐ ุงูุชุงูู:
VACUUM ANALYZE "Subscription";
```

---

## โ ูุตุงุฆุญ ูุชุฌูุจ ุงููุดุงูู

### **1. ุงุณุชุฎุฏู ุงููููุงุช ุงูุขููุฉ:**
- โ `supabase-safe-cleanup.sql` ุจุฏูุงู ูู ุงูููู ุงููุฏูู
- โ `supabase-vacuum-optimize.sql` ูููุตู

### **2. ููุฐ ุฎุทูุฉ ุจุฎุทูุฉ:**
- ูุง ุชููุฐ ุฃูุงูุฑ ูุซูุฑุฉ ูุฑุฉ ูุงุญุฏุฉ
- ุฑุงูุจ ุงููุชุงุฆุฌ ูุจู ุงููุชุงุจุนุฉ

### **3. ุงุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุฏุงุฆูุงู:**
- ูุจู ุฃู ุชุบููุฑ ูุจูุฑ
- ุงุฎุชุจุฑ ุนูู ุจูุฆุฉ ุชุทููุฑ ุฃููุงู

### **4. ุฑุงูุจ ุงูุฃุฏุงุก:**
- ูุณ ููุช ุงูุงุณุชุนูุงูุงุช ูุจู ูุจุนุฏ
- ุชุฃูุฏ ูู ุนูู ุงููุธุงู ุจุดูู ุทุจูุนู

---

## ๐ฏ ุงููุฏู ุงูููุงุฆู

ุจุนุฏ ุงูุชูุธูู ุงููุงุฌุญ ุณุชุญุตู ุนูู:

โ **ูุงุนุฏุฉ ุจูุงูุงุช ูุจุณุทุฉ** ูุน 3 ุฌุฏุงูู ููุท  
โ **ุฃุฏุงุก ูุญุณู** ูุน ููุงุฑุณ ูุญุณูุฉ  
โ **ูุธุงู ุขูู** ูุน constraints ููุญูุงูุฉ  
โ **ุณูููุฉ ูู ุงูุฅุฏุงุฑุฉ** ูุงููุฑุงูุจุฉ  

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. **ุชุฃูุฏ ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ** ูุจู ุงููุชุงุจุนุฉ
2. **ููุฐ ุฎุทูุฉ ูุงุญุฏุฉ ูู ูู ูุฑุฉ**
3. **ุฑุงุฌุน ุงููุชุงุฆุฌ** ูุจู ุงูุฎุทูุฉ ุงูุชุงููุฉ
4. **ุงุณุชุฎุฏู ุงููููุงุช ุงูุขููุฉ ุงูุฌุฏูุฏุฉ** ููุท

**ูุง ุชุณุชุฎุฏู ููู `supabase-cleanup-unused-tables.sql` ุงููุฏูู!** 